function S(e,n=""){let o=document.querySelector(e);if(!o)return;if(n){let i=o.querySelector(".order-overlay__message");i&&(i.textContent=n)}o.classList.add("active"),document.body.classList.add("body--noscroll");let t=o.querySelector(".order-overlay__close");t&&t.addEventListener("click",()=>{o.classList.remove("active"),document.body.classList.remove("body--noscroll")},{once:!0}),o.addEventListener("click",i=>{i.target===o&&(o.classList.remove("active"),document.body.classList.remove("body--noscroll"))},{once:!0})}function $(e,n,o,t){let i=e%10,s=e%100;return s>=11&&s<=14?t:i===1?n:i>=2&&i<=4?o:t}function v(e){document.querySelectorAll(".cart-list__item").forEach(c=>{let l=Number(c.dataset.id),r=e.find(h=>h.id===l);if(!r)return;let a=c.querySelector(".cart-list__old-price"),d=c.querySelector(".cart-list__price"),u=c.querySelector(".cart-list__old-total"),f=c.querySelector(".cart-list__total"),y=c.querySelector(".cart-list__qty-input"),g=c.querySelector(".cart-list__qty-btn--minus");a&&r.oldPrice&&(a.textContent=r.oldPrice.toLocaleString("ru-RU")+" \u20BD"),d&&(d.textContent=r.price.toLocaleString("ru-RU")+" \u20BD"),y&&(y.value=r.qty),g&&(g.disabled=r.qty<=1),u&&r.oldPrice&&(u.textContent=(r.qty*r.oldPrice).toLocaleString("ru-RU")+" \u20BD"),f&&(f.textContent=(r.qty*r.price).toLocaleString("ru-RU")+" \u20BD")});let o=e.reduce((c,l)=>c+l.qty,0),t=e.reduce((c,l)=>c+l.price*l.qty,0),i=document.querySelector(".cart__summary-price");i&&(i.textContent=t.toLocaleString("ru-RU")+" \u20BD");let s=document.querySelector(".cart__descr");if(s){let c=$(o,"\u0442\u043E\u0432\u0430\u0440","\u0442\u043E\u0432\u0430\u0440\u0430","\u0442\u043E\u0432\u0430\u0440\u043E\u0432");s.innerHTML=`${o} ${c} <br> \u043D\u0430 \u0441\u0443\u043C\u043C\u0443 <span class="cart__summary-price">${t.toLocaleString("ru-RU")}\xA0\u20BD</span>`}return e.map(c=>({id:c.id,qty:c.qty,price:c.price,oldPrice:c.oldPrice||null,total:c.price*c.qty}))}function p(e,n=null){let o=document.querySelectorAll(".cart-list__item"),t=0,i=0;o.forEach(d=>{let u=d.querySelector(".cart-list__price"),f=d.querySelector(".cart-list__old-price"),y=d.querySelector(".cart-list__qty-input"),g=parseInt(u?.textContent.replace(/\D/g,""),10)||0,h=parseInt(f?.textContent.replace(/\D/g,""),10)||g,_=parseInt(y?.value,10)||1;t+=g*_,i+=h*_});let s=0;n&&(n.type==="percent"?s=Math.floor(t*(n.discount/100)):n.type==="fixed"&&(s=n.discount));let c=i-t,l=c+s||0,r=200,a=t-s+r;return document.querySelector(".order-summary-price--total").textContent=`${t.toLocaleString("ru-RU")} \u20BD`,document.querySelector(".order-summary-price--discount").textContent=c>0?`\u2212 ${l.toLocaleString("ru-RU")} \u20BD`:"0 \u20BD",document.querySelector(".order-summary-price--action").textContent=c>0?`\u2212 ${c.toLocaleString("ru-RU")} \u20BD`:"0 \u20BD",document.querySelector(".order-summary-price--promo").textContent=s>0?`\u2212 ${s.toLocaleString("ru-RU")} \u20BD`:"0 \u20BD",document.querySelector(".order-summary-price--delivery").textContent=`${r.toLocaleString("ru-RU")} \u20BD`,document.querySelectorAll(".order-summary__summary-price--bold").forEach(d=>{d.textContent=`${a.toLocaleString("ru-RU")} \u20BD`}),{totalCurrent:t,action:c,promoValue:s,delivery:r,grandTotal:a,promoCode:n?n.code:null}}function L(e){let n=document.querySelector(".cart-list");n.addEventListener("click",o=>{let t=o.target.closest(".cart-list__qty-btn--plus"),i=o.target.closest(".cart-list__qty-btn--minus"),s=o.target.closest(".cart-list__item");if(!s)return;let c=Number(s.dataset.id),l=e.find(u=>u.id===c),r=s.querySelector(".cart-list__qty-input"),a=s.querySelector(".cart-list__qty-btn--minus"),d=()=>{a.disabled=Number(r.value)<=1};t&&(r.value=Number(r.value)+1,l&&(l.qty=Number(r.value)),d(),v(e),p(e)),i&&Number(r.value)>1&&(r.value=Number(r.value)-1,l&&(l.qty=Number(r.value)),d(),v(e),p(e))}),n.addEventListener("input",o=>{let t=o.target.closest(".cart-list__qty-input");if(!t)return;let i=t.closest(".cart-list__item"),s=Number(i.dataset.id),c=e.find(a=>a.id===s),l=i.querySelector(".cart-list__qty-btn--minus"),r=t.value.replace(/\D/g,"");r=r===""?1:Number(r),r<1&&(r=1),t.value=r,c&&(c.qty=r),l.disabled=r<=1,v(e),p(e)})}function E(){window.ymaps.ready(()=>{window.myMap=new window.ymaps.Map("map",{center:[59.9386,30.3141],zoom:12,controls:[],suppressMapOpenBlock:!0}),window.myPlacemark=new window.ymaps.Placemark([59.9386,30.3141],{},{iconLayout:"default#image",iconImageHref:"images/map-pin.png",iconImageSize:[26,37],iconImageOffset:[-13,-37],draggable:!0}),window.myMap.geoObjects.add(window.myPlacemark);let e=document.getElementById("address");function n(o){window.ymaps.geocode(o).then(t=>{let s=t.geoObjects.get(0).getAddressLine();e&&(e.value=s)})}window.myPlacemark.events.add("dragend",()=>{let o=window.myPlacemark.geometry.getCoordinates();n(o)}),window.myMap.events.add("click",o=>{let t=o.get("coords");window.myPlacemark.geometry.setCoordinates(t),n(t)})})}function w(){let e="fe79d58476db2b061699143532f7c3b8dc2d1766",n=document.getElementById("address"),o=document.getElementById("search-address"),t=document.getElementById("suggestions"),i=-1;async function s(r){if(!r)return;let d=await(await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Token ${e}`},body:JSON.stringify({query:r})})).json();if(t.innerHTML="",i=-1,d.suggestions.length===0){let u=document.createElement("li");u.textContent="\u0410\u0434\u0440\u0435\u0441 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D",u.classList.add("suggestions__item"),t.appendChild(u)}else d.suggestions.forEach((u,f)=>{let y=document.createElement("li");y.classList.add("suggestions__item"),y.textContent=u.value,y.addEventListener("click",()=>{c(u)}),t.appendChild(y)});t.style.display="block"}function c(r){n.value=r.value,t.style.display="none";let a=r.data.geo_lat,d=r.data.geo_lon;a&&d&&window.myPlacemark&&window.myMap&&(window.myPlacemark.geometry.setCoordinates([a,d]),window.myMap.setCenter([a,d],16))}function l(r){let a=t.querySelectorAll(".suggestions__item");a.length&&(i=(i+r+a.length)%a.length,a.forEach(d=>d.classList.remove("suggestions__item--active")),a[i].classList.add("suggestions__item--active"))}o.addEventListener("click",()=>{let r=n.value.trim();s(r)}),n.addEventListener("input",()=>{let r=n.value.trim();r.length>2?s(r):t.style.display="none"}),n.addEventListener("keydown",r=>{let a=t.querySelectorAll(".suggestions__item");switch(r.key){case"ArrowDown":r.preventDefault(),l(1);break;case"ArrowUp":r.preventDefault(),l(-1);break;case"Enter":if(i>=0&&a[i]){r.preventDefault();let u={value:a[i].textContent,data:{}};c(u)}break;case"Escape":t.style.display="none";break}}),document.addEventListener("click",r=>{!n.contains(r.target)&&!t.contains(r.target)&&(t.style.display="none")}),n.addEventListener("blur",r=>{setTimeout(()=>{!t.contains(document.activeElement)&&document.activeElement!==o&&(t.style.display="none")},150)})}function H(e,n){!e||!n||n.nextElementSibling!==e&&(n.insertAdjacentElement("afterend",e),console.log("\u041A\u0430\u0440\u0442\u0430 \u0432 main"))}function O(e,n){!e||!n||n.contains(e)||(n.appendChild(e),console.log("\u041A\u0430\u0440\u0442\u0430 \u0432 contacts"))}function x(){let e=document.getElementById("map"),n=document.querySelector(".form__contacts"),o=document.getElementById("form");if(!e||!n||!o)return;let t=window.matchMedia("(min-width: 1200px)"),i=s=>{s.matches?H(e,o):O(e,n),window.myMap&&window.myMap.container.fitToViewport()};i(t),t.addEventListener("change",i)}var R={};function k(e){let n=document.querySelector(".cart-list");e.forEach(o=>{let t=document.querySelector(`.cart-list__item[data-id="${o.id}"]`);t&&(R[o.id]=t.innerHTML)}),n.addEventListener("click",o=>{let t=o.target.closest("[data-action]");if(!t)return;let i=t.dataset.action,s=t.closest(".cart-list__item"),c=Number(s.dataset.id),l=e.find(r=>r.id===c);if(l)switch(i){case"remove":l.removed=!0,s.classList.add("cart-list__item--removed"),s.innerHTML=`
          <div class="cart-list__divider">
              <div class="cart-list__placeholder">
                <span class="cart-list__placeholder-text">
                  \u0422\u043E\u0432\u0430\u0440 <span class="cart-list__placeholder-text--bold">${l.title}</span> \u0431\u044B\u043B \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B.
                </span>
                <button type="button" class="cart-list__remove cart-list__remove-final" data-action="remove-final" aria-label="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043E\u043A\u043E\u043D\u0447\u0430\u0442\u0435\u043B\u044C\u043D\u043E">
                  <svg class="cart-list__icon">
                    <use href="icons/stack.svg#close"></use>
                  </svg>
                </button>
            </div>
            <button type="button" data-action="restore" class="cart-list__restore">\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C</button>
          </div>
        `;break;case"restore":l.removed=!1,s.innerHTML=R[c],s.classList.remove("cart-list__item--removed");break;case"remove-final":e.splice(e.indexOf(l),1),s.remove();break}})}function C(e,n){let o=document.querySelector(".order-summary__promo-input"),t=document.querySelector(".order-summary__promo-label"),i=document.querySelector(".order-summary__promo-button"),s=document.querySelector(".order-summary__promo-message"),c=document.querySelector(".order-summary__row--promo"),l=document.querySelector(".order-summary__promo-remove"),r=null;o.addEventListener("input",()=>{o.value.trim()!==""?(i.classList.add("visible"),o.classList.remove("order-summary__promo-input--error"),t.classList.remove("order-summary__promo-label--error")):(i.classList.remove("visible"),s.textContent="")}),i.addEventListener("click",a=>{a.preventDefault();let d=o.value.trim().toUpperCase();s.className="order-summary__promo-message",r=null,n[d]?(r={code:d,...n[d]},window.appliedPromo=r,p(e,r),s.textContent=`${d} \u2013 \u043A\u0443\u043F\u043E\u043D \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D`,s.classList.add("order-summary__promo-message--success"),c.style.display="flex",l.style.display="inline-block"):(p(e,null),s.textContent=`${d} \u2013 \u043A\u0443\u043F\u043E\u043D \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D`,s.classList.add("order-summary__promo-message--error"),o.classList.add("order-summary__promo-input--error"),t.classList.add("order-summary__promo-label--error"),c.style.display="flex",l.style.display="inline-block")}),l.addEventListener("click",()=>{r=null,o.value="",s.textContent="",c.style.display="none",i.classList.remove("visible"),l.style.display="none",p(e,null)})}function M(e){let n=e.querySelector("#firstname"),o=e.querySelector("#lastname"),t=e.querySelector("#phone"),i=e.querySelector("#email");e.querySelectorAll(".error").forEach(a=>a.remove());let s=!0,c=/^[A-Za-zА-Яа-яЁё]{2,}$/,l=/^\+7\s?\(?\d{3}\)?\s?\d{3}\s?\d{2}\s?\d{2}$/,r=/^[^\s@]+@[^\s@]+\.[A-Za-zА-Яа-яЁё\u0400-\u04FF0-9-]{2,}$/u;return c.test(n.value.trim())||(s=!1,b(n,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E")),c.test(o.value.trim())||(s=!1,b(o,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0444\u0430\u043C\u0438\u043B\u0438\u044E \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E")),l.test(t.value.trim())||(s=!1,b(t,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")),r.test(i.value.trim())||(s=!1,b(i,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443")),q(n,c,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E"),q(o,c,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0444\u0430\u043C\u0438\u043B\u0438\u044E \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E"),q(t,l,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),q(i,r,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443"),s}function q(e,n,o){e.dataset.validationAttached||(e.addEventListener("input",()=>{n.test(e.value.trim())?U(e):b(e,o)}),e.addEventListener("blur",()=>{n.test(e.value.trim())||b(e,o)}),e.dataset.validationAttached="true")}function b(e,n){let o=e.closest(".form__field");if(!o)return;let t=o.querySelector(".error");t&&t.remove(),e.classList.add("form__field-input--error");let i=o.querySelector(".form__field-label");i&&i.classList.add("form__field-label--error");let s=document.createElement("span");s.classList.add("error"),s.textContent=n,o.appendChild(s)}function U(e){let n=e.closest(".form__field");if(!n)return;let o=n.querySelector(".error");o&&o.remove(),e.classList.remove("form__field-input--error");let t=n.querySelector(".form__field-label");t&&t.classList.remove("form__field-label--error")}function P(e,n=null){let o={};o.cart=e.map(i=>({id:i.id,qty:i.qty,price:i.price,oldPrice:i.oldPrice||null,total:i.price*i.qty})),o.options=[],document.querySelectorAll(".cart-list__item").forEach(i=>{let s=i.dataset.id,c=i.querySelector(`input[name="size-${s}"]:checked`),l=i.querySelector(`input[name="color-${s}"]:checked`);o.options.push({id:s,size:c?c.value:null,color:l?l.value:null})});let t=document.querySelector(".order-summary__pickup-input");return o.pickup=t?t.checked:!1,n&&(o.promo=n),o}function B(e,n,o=null){let t=document.getElementById(e);t.addEventListener("submit",i=>{i.preventDefault();let s=document.querySelector("#promo"),c=document.querySelector(".order-summary__promo-message"),l=document.querySelector(".order-summary__promo-button"),r=document.querySelector(".order-summary__promo-btn"),a=P(n),d=p(n,window.appliedPromo);function u(){s&&(s.value=""),c&&(c.textContent=""),l&&l.classList.remove("visible"),t.reset()}let f={IDLE:"\u041E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437",SENDING:"\u041E\u0444\u043E\u0440\u043C\u043B\u044F\u044E..."},y=m=>{r.disabled=m,r.textContent=m?f.SENDING:f.IDLE};if(!M(t)){let m=t.querySelector(".error");if(m){m.scrollIntoView({behavior:"smooth",block:"center"});let N=m.closest(".form__field")?.querySelector("input, textarea");N&&N.focus()}return}let h=new FormData(t),_=Object.fromEntries(h.entries());_["cart-info"]=a,_["summary-data"]=d,console.log("\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u043C:",_),y(!0),fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)}).then(m=>{if(!m.ok)throw new Error("Network response was not ok");return m.json()}).then(m=>{console.log("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E:",m),u(),S("#order-overlay","\u0412\u0430\u0448 \u0437\u0430\u043A\u0430\u0437 \u043F\u0440\u0438\u043D\u044F\u0442!"),document.querySelector(".order-summary__promo-remove").style.display="none"}).catch(m=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435:",m),S("#order-overlay","\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}).finally(()=>{y(!1)})})}function I(){let e=document.querySelector(".burger"),n=document.getElementById("mobile"),o=n.querySelector(".mobile-menu__close");e.addEventListener("click",()=>{n.classList.add("active"),o.classList.add("mobile-menu__close--active"),document.body.classList.add("body--noscroll")}),o.addEventListener("click",()=>{n.classList.remove("active"),o.classList.remove("mobile-menu__close--active"),document.body.classList.remove("body--noscroll")})}function A(){let e=document.querySelector("#up");function n(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)}window.addEventListener("scroll",()=>{let o=n();window.innerHeight+window.scrollY>=o-10?e.style.display="block":e.style.display="none"}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function T(e){let n=(i,s)=>{if(s.focus(),s.setSelectionRange)s.setSelectionRange(i,i);else if(s.createTextRange){let c=s.createTextRange();c.collapse(!0),c.moveEnd("character",i),c.moveStart("character",i),c.select()}};function o(i){let s="+7 (___) ___ __ __",c=0,l=s.replace(/\D/g,""),r=this.value.replace(/\D/g,"");l.length>=r.length&&(r=l),this.value=s.replace(/./g,function(a){return/[_\d]/.test(a)&&c<r.length?r.charAt(c++):c>=r.length?"":a}),i.type==="blur"?this.value.length==2&&(this.value=""):n(this.value.length,this)}let t=document.querySelector(e);t.addEventListener("input",o),t.addEventListener("focus",o),t.addEventListener("blur",o)}function D(){let e=document.getElementById("comment"),n=document.querySelector(".form__comment-hint"),o=142;function t(){let i=e.value.length;n.textContent=`\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E ${i}/${o} \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432`}t(),e.addEventListener("input",t)}document.addEventListener("DOMContentLoaded",async()=>{let e=[{id:1,price:1e4,oldPrice:12e3,qty:2,title:"\u0423\u0442\u0435\u043F\u043B\u0435\u043D\u043D\u0430\u044F \u0441\u0442\u0435\u0433\u0430\u043D\u043D\u0430\u044F \u043A\u0443\u0440\u0442\u043A\u0430 \u0436\u0435\u043D\u0441\u043A\u0430\u044F Top Hills"},{id:2,price:500,qty:1,title:"\u0412\u044F\u0437\u0430\u043D\u043D\u0430\u044F \u0448\u0430\u043F\u043A\u0430 Zolla"},{id:3,price:3e3,oldPrice:4e3,qty:2,title:"\u0423\u0442\u0435\u043F\u043B\u0435\u043D\u043D\u0430\u044F \u0441\u0442\u0435\u0433\u0430\u043D\u043D\u0430\u044F \u043A\u0443\u0440\u0442\u043A\u0430 \u0436\u0435\u043D\u0441\u043A\u0430\u044F Top Hills"}],n={B6D9FC:{discount:500,type:"fixed"},HELLO10:{discount:10,type:"percent"}};E(),w(),x(),I(),A(),v(e),p(e),L(e),k(e),C(e,n),B("form",e),T('[name="phone"]'),D()});

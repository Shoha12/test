function q(){window.ymaps.ready(()=>{window.myMap=new window.ymaps.Map("map",{center:[59.9386,30.3141],zoom:12,controls:[],suppressMapOpenBlock:!0}),window.myPlacemark=new window.ymaps.Placemark([59.9386,30.3141],{},{iconLayout:"default#image",iconImageHref:"images/map-pin.png",iconImageSize:[26,37],iconImageOffset:[-13,-37],draggable:!0}),window.myMap.geoObjects.add(window.myPlacemark);let e=document.getElementById("address");function o(r){window.ymaps.geocode(r).then(n=>{let c=n.geoObjects.get(0).getAddressLine();e&&(e.value=c)})}window.myPlacemark.events.add("dragend",()=>{let r=window.myPlacemark.geometry.getCoordinates();o(r)}),window.myMap.events.add("click",r=>{let n=r.get("coords");window.myPlacemark.geometry.setCoordinates(n),o(n)});let t="\u0433. \u0421\u0430\u043D\u043A\u0442-\u041F\u0435\u0442\u0435\u0440\u0431\u0443\u0440\u0433, \u043F\u0440. \u041F\u0440\u043E\u0441\u0432\u0435\u0449\u0435\u043D\u0438\u044F, \u0434. 99, \u043A\u0432. 152";window.ymaps.geocode(t).then(r=>{let n=r.geoObjects.get(0).geometry.getCoordinates();window.myMap.setCenter(n,16),window.myPlacemark.geometry.setCoordinates(n),e&&(e.value=t)})})}function w(){let e="fe79d58476db2b061699143532f7c3b8dc2d1766",o=document.getElementById("address"),t=document.getElementById("search-address"),r=document.getElementById("suggestions");async function n(s){if(!s)return;let i=await(await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Token ${e}`},body:JSON.stringify({query:s})})).json();if(r.innerHTML="",i.suggestions.length===0){let a=document.createElement("li");a.textContent="\u0410\u0434\u0440\u0435\u0441 \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D",r.appendChild(a)}else i.suggestions.forEach((a,m)=>{let d=document.createElement("li");d.classList.add("suggestions__item"),d.textContent=a.value,m===0&&d.classList.add("suggestions__item--active"),d.addEventListener("click",()=>{document.querySelectorAll(".suggestions__item").forEach(f=>f.classList.remove("suggestions__item--active")),d.classList.add("suggestions__item--active"),o.value=a.value,r.style.display="none";let u=a.data.geo_lat,p=a.data.geo_lon;u&&p&&window.myPlacemark&&window.myMap&&(window.myPlacemark.geometry.setCoordinates([u,p]),window.myMap.setCenter([u,p],16))}),r.appendChild(d)});r.style.display="block"}t.addEventListener("click",()=>{let s=o.value.trim();n(s)}),o.addEventListener("input",()=>{let s=o.value.trim();s.length>2?n(s):r.style.display="none"})}function S(e){e.forEach(o=>{if(o.removed)return;let t=document.querySelector(`.cart-list__item[data-id="${o.id}"]`);if(!t)return;let r=t.querySelector(".cart-list__title"),n=t.querySelector(".cart-list__price"),s=t.querySelector(".cart-list__qty-input"),c=t.querySelector(".cart-list__total"),i=t.querySelector(".cart-list__old-price"),a=t.querySelector(".cart-list__old-total"),m=t.querySelector(`input[name="size-${o.id}"][value="${o.size}"]`),d=t.querySelector(`input[name="color-${o.id}"][value="${o.color}"]`),u=t.querySelector(".cart-list__qty-btn--minus");r&&(r.textContent=o.title),n&&(n.textContent=o.price.toLocaleString()+" \u20BD"),s&&(s.value=o.qty),c&&(c.textContent=(o.qty*o.price).toLocaleString()+" \u20BD"),i&&(o.oldPrice?(i.textContent=o.oldPrice.toLocaleString()+" \u20BD",i.style.display="inline"):i.style.display="none"),a&&(o.oldPrice?(a.textContent=(o.oldPrice*o.qty).toLocaleString()+" \u20BD",a.style.display="inline"):a.style.display="none"),m&&(m.checked=!0),d&&(d.checked=!0),u&&(u.disabled=o.qty<=1)})}function A(e){return e.map(o=>{if(o.removed)return null;let t=document.querySelector(`.cart-list__item[data-id="${o.id}"]`);if(!t)return null;let r=t.querySelector(`input[name="size-${o.id}"]:checked`)?.value,n=t.querySelector(`input[name="color-${o.id}"]:checked`)?.value,s=Number(t.querySelector(".cart-list__qty-input")?.value||1);return{id:o.id,size:r,color:n,qty:s}}).filter(Boolean)}function v(e,o={code:"",value:0}){let t=document.querySelector(".cart__aside-price--discount"),r=document.querySelector(".cart__aside-price--action"),n=document.querySelector(".cart__aside-price--promo"),s=document.querySelector(".cart__aside-price--total"),c=document.querySelector(".cart__aside-price--delivery"),i=document.querySelectorAll(".cart__summary-price"),a=0,m=0;e.forEach(_=>{a+=_.price*_.qty,m+=(_.oldPrice||_.price)*_.qty});let d=o.code||"",u=o.value||0,p=m-a,f=p+u,l=200,y=a+l-u;return t&&(t.textContent=f>0?`\u2212 ${f.toLocaleString()} \u20BD`:"0 \u20BD"),r&&(r.textContent=p>0?`\u2212 ${p.toLocaleString()} \u20BD`:"0 \u20BD"),n&&(n.textContent=u>0?`\u2212 ${u.toLocaleString()} \u20BD`:"0 \u20BD"),s&&(s.textContent=a.toLocaleString()+" \u20BD"),c&&(c.textContent=l.toLocaleString()+" \u20BD"),i.forEach(_=>{_.textContent=y.toLocaleString()+" \u20BD"}),{promoCode:d,promoValue:u,grandTotal:y,discount:f,action:p,delivery:l}}function b(e,o){let t=document.querySelector(".cart__promo-input"),r=document.querySelector(".cart__promo-label"),n=document.querySelector(".cart__promo-button"),s=document.querySelector(".cart__promo-message"),c=document.querySelector(".cart__row--promo");t.addEventListener("input",()=>{t.value.trim()!==""?(n.classList.add("visible"),t.classList.remove("cart__promo-input--error"),r.classList.remove("cart__promo-label--error")):(n.classList.remove("visible"),s.textContent="")}),t.addEventListener("blur",()=>{t.value.trim()===""&&(n.classList.remove("visible"),s.textContent="")});let i=null;n.addEventListener("click",a=>{a.preventDefault();let m=t.value.trim().toUpperCase();if(s.className="cart__promo-message",i=null,e[m]){let d=e[m],u=0;if(d.type==="fixed")u=d.discount;else if(d.type==="percent"){let p=o.reduce((f,l)=>f+l.price*l.qty,0);u=Math.floor(p*(d.discount/100))}i={code:m,value:u},v(o,i),s.textContent=`${m} - \u043A\u0443\u043F\u043E\u043D \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D`,s.classList.add("cart__promo--success"),c.style.display="flex"}else s.textContent=`${m} - \u043A\u0443\u043F\u043E\u043D \u043D\u0435 \u043F\u0440\u0438\u043C\u0435\u043D\u0435\u043D`,s.classList.add("cart__promo--error"),t.classList.add("cart__promo-input--error"),r.classList.add("cart__promo-label--error"),c.style.display="flex"})}var E=null;async function N(){return E||(E=await(await fetch("./mocks/cart.json")).json()),E}var C=null;async function T(){return C||(C=await(await fetch("./mocks/promo.json")).json()),C}function x(e){document.querySelector(".cart-list").addEventListener("click",t=>{let r=t.target.closest(".cart-list__qty-btn"),n=r.closest(".cart-list__item"),s=Number(n.dataset.id),c=e.find(i=>i.id===s);r.classList.contains("cart-list__qty-btn--minus")&&c.qty>1&&c.qty--,r.classList.contains("cart-list__qty-btn--plus")&&c.qty++,S(e),v(e)})}var D={};function k(e){let o=document.querySelector(".cart-list");e.forEach(t=>{let r=document.querySelector(`.cart-list__item[data-id="${t.id}"]`);r&&(D[t.id]=r.innerHTML)}),o.addEventListener("click",t=>{let r=t.target.closest("[data-action]");if(!r)return;let n=r.dataset.action,s=r.closest(".cart-list__item"),c=Number(s.dataset.id),i=e.find(a=>a.id===c);if(i)switch(n){case"remove":i.removed=!0,s.classList.add("cart-list__item--removed"),s.innerHTML=`
          <div class="cart-list__divider">
              <div class="cart-list__placeholder">
                <span class="cart-list__placeholder-text">
                  \u0422\u043E\u0432\u0430\u0440 <span class="cart-list__placeholder-text--bold">${i.title}</span> \u0431\u044B\u043B \u0443\u0434\u0430\u043B\u0451\u043D \u0438\u0437 \u043A\u043E\u0440\u0437\u0438\u043D\u044B.
                </span>
                <button type="button" class="cart-list__remove cart-list__remove-final" data-action="remove-final" aria-label="\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043E\u043A\u043E\u043D\u0447\u0430\u0442\u0435\u043B\u044C\u043D\u043E">
                  <svg class="cart-list__icon">
                    <use href="icons/stack.svg#close"></use>
                  </svg>
                </button>
            </div>
            <button type="button" data-action="restore" class="cart-list__restore">\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u044C</button>
          </div>
        `;break;case"restore":i.removed=!1,s.innerHTML=D[c],s.classList.remove("cart-list__item--removed");break;case"remove-final":e.splice(e.indexOf(i),1),s.remove();break}})}function M(e){let o=e.querySelector("#firstname"),t=e.querySelector("#lastname"),r=e.querySelector("#phone"),n=e.querySelector("#email");e.querySelectorAll(".error").forEach(m=>m.remove());let s=!0,c=/^[A-Za-zА-Яа-яЁё]{2,}$/,i=/^(\+7|7|8)?\d{7,}$/,a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return c.test(o.value.trim())||(s=!1,g(o,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E")),c.test(t.value.trim())||(s=!1,g(t,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0444\u0430\u043C\u0438\u043B\u0438\u044E \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E")),i.test(r.value.trim())||(s=!1,g(r,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430")),a.test(n.value.trim())||(s=!1,g(n,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443")),L(o,c,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0438\u043C\u044F \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E"),L(t,c,"\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0444\u0430\u043C\u0438\u043B\u0438\u044E \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E"),L(r,i,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0439 \u043D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430"),L(n,a,"\u0423\u043A\u0430\u0436\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u0443\u044E \u043F\u043E\u0447\u0442\u0443"),s}function L(e,o,t){e.dataset.validationAttached||(e.addEventListener("input",()=>{o.test(e.value.trim())?H(e):g(e,t)}),e.addEventListener("blur",()=>{o.test(e.value.trim())||g(e,t)}),e.dataset.validationAttached="true")}function g(e,o){let t=e.closest(".form__field");if(!t)return;let r=t.querySelector(".error");r&&r.remove(),e.classList.add("form__field-input--error");let n=t.querySelector(".form__field-label");n&&n.classList.add("form__field-label--error");let s=document.createElement("span");s.classList.add("error"),s.textContent=o,t.appendChild(s)}function H(e){let o=e.closest(".form__field");if(!o)return;let t=o.querySelector(".error");t&&t.remove(),e.classList.remove("form__field-input--error");let r=o.querySelector(".form__field-label");r&&r.classList.remove("form__field-label--error")}function h(e,o=""){let t=document.querySelector(e);if(!t)return;if(o){let n=t.querySelector(".order-overlay__message");n&&(n.textContent=o)}t.classList.add("active");let r=t.querySelector(".order-overlay__close");r&&r.addEventListener("click",()=>{t.classList.remove("active")},{once:!0}),t.addEventListener("click",n=>{n.target===t&&t.classList.remove("active")},{once:!0})}function P(e,o){e.addEventListener("submit",t=>{t.preventDefault();let r=document.querySelector("#promo"),n=document.querySelector(".cart__promo-message"),s=document.querySelector(".cart__promo-button"),c=document.querySelector(".cart__promo-btn"),i=A(o),a=v(o);function m(l,y,_,j){y&&(y.value=""),_&&(_.textContent=""),j&&j.classList.remove("visible"),l.reset()}let d={IDLE:"\u041E\u0444\u043E\u0440\u043C\u0438\u0442\u044C \u0437\u0430\u043A\u0430\u0437",SENDING:"\u041E\u0444\u043E\u0440\u043C\u043B\u044F\u044E..."},u=l=>{c.disabled=l,c.textContent=l?d.SENDING:d.IDLE};if(!M(e)){let l=e.querySelector(".error");if(l){l.scrollIntoView({behavior:"smooth",block:"center"});let y=l.closest(".form__field").querySelector("input, textarea");y&&y.focus()}return}let f=new FormData(e);f.append("cart-info",JSON.stringify(i)),f.append("summary-data",JSON.stringify(a));for(let[l,y]of f.entries())console.log(l,y);u(!0),fetch("https://jsonplaceholder.typicode.com/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then(l=>{if(!l.ok)throw new Error("Network response was not ok");return l.json()}).then(l=>{console.log("\u0423\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E:",l),m(e,r,n,s),h("#order-overlay","\u0412\u0430\u0448 \u0437\u0430\u043A\u0430\u0437 \u043F\u0440\u0438\u043D\u044F\u0442!")}).catch(l=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435:",l),h("#order-overlay","\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437")}).finally(()=>{u(!1)})})}function B(){let e=document.getElementById("comment"),o=document.querySelector(".form__comment-hint"),t=142;function r(){let n=e.value.length;o.textContent=`\u0418\u0441\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u043D\u043E ${n}/${t} \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432`}r(),e.addEventListener("input",r)}function I(){let e=document.querySelector(".burger"),o=document.getElementById("mobile"),t=o.querySelector(".mobile-menu__close"),r=document.querySelector(".menu-list");e.addEventListener("click",()=>{o.classList.add("active"),t.classList.add("mobile-menu__close--active");let n=o.querySelector(".mobile-menu__list.menu-list");n&&r&&(n.innerHTML="",r.querySelectorAll(".menu-list__item").forEach(s=>{let c=s.cloneNode(!0);c.classList.add("menu-list__item--mobile");let i=c.querySelector(".menu-list__link");i&&i.classList.add("menu-list__link--mobile"),n.appendChild(c)}))}),t.addEventListener("click",()=>{o.classList.remove("active"),t.classList.remove("mobile-menu__close--active")})}function z(){let e=document.getElementById("map"),o=document.querySelector(".form__contacts"),t=document.getElementById("form");window.innerWidth>=1200?(t.insertAdjacentElement("afterend",e),console.log("\u041A\u0430\u0440\u0442\u0430 \u0432 main")):(o.appendChild(e),console.log("\u041A\u0430\u0440\u0442\u0430 \u0432 contacts")),window.myMap&&window.myMap.container.fitToViewport()}function $(){z(),window.addEventListener("resize",z)}function O(){let e=document.querySelector("#up");window.addEventListener("scroll",()=>{window.innerHeight+window.scrollY>=document.body.offsetHeight-10?e.style.display="block":e.style.display="none"}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}document.addEventListener("DOMContentLoaded",async()=>{let[e,o]=await Promise.all([N(),T()]);q(),w(),S(e),v(e),b(o,e),x(e),k(e),B();let t=document.querySelector("#form");P(t,e),I(),$(),O()});
